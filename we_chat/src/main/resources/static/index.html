<!DOCTYPE html>
<html>
<head>
	<title>wx测试H5页面</title>
	<meta charset="utf-8">
	<meta content="关键字" name="Keywords">
	<meta content="djl" name="author">
	<meta content="描述" name="description">
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
	<link rel="shortcut icon" type="image/x-icon" href="./assets/images/title.ico">
	<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
	<script type="text/javascript">
		var link = window.location.href;
		var xhr = new XMLHttpRequest();
		var url = "https://dongjinlong123.xyz/djl/getInitConfig?url="+link;
		xhr.open("GET",url,true);
		//timeout 超时
		xhr.timeout = 3000

		xhr.addEventListener("timeout",function(){
			this.abort()//中断发送
		},false)
		xhr.responseType = "json"
	
		xhr.onreadystatechange=function(){
				
				if(xhr.readyState == 4 && xhr.status == 200){
					//配置responseType 直接转化json格式
					console.log(xhr.response)
					var obj =xhr.response;	
					//{signature: "0d3f0a5d88cb5d4ddc8fd1dd3cd2f8edc4ab916a", jsapi_ticket: null, nonceStr: "kAKofFBk6MnoZKSP", url: "http://localhost:3000/wx.html", timestamp: "1540877765"}
					wx.config({
					    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
					    appId: 'wxb2575c2a7bc5f239', // 必填，公众号的唯一标识
					    timestamp:obj.timestamp , // 必填，生成签名的时间戳
					    nonceStr: obj.nonceStr, // 必填，生成签名的随机串
					    signature: obj.signature,// 必填，签名
					    jsApiList: ['updateAppMessageShareData','updateTimelineShareData '] // 必填，需要使用的JS接口列表
					});
					share();
				} 
			}
		xhr.send();

		function share(){
			wx.ready(function () {   //需在用户可能点击分享按钮前就先调用
				    wx.updateAppMessageShareData({ 
				        title: '二狗', // 分享标题
				        desc: '分享案例', // 分享描述
				        link: link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
				        imgUrl: 'https://iobs.pingan.com.cn/download/mvip-core-dmz-prd/v3_vip_migou_usbtaideng_icon?2018103013', // 分享图标
					}, function(res) { 
					//这里是回调函数 
				}); 
			});

			wx.ready(function () {      //需在用户可能点击分享按钮前就先调用
			    wx.updateTimelineShareData({ 
			        title: '二狗', // 分享标题
			        link: link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
			        imgUrl: 'https://iobs.pingan.com.cn/download/mvip-core-dmz-prd/v3_vip_migou_usbtaideng_icon?2018103013', // 分享图标
				}, function(res) { 
				//这里是回调函数 
				}); 
			});
		}
		

	</script>
</head>
<body>
	这是一个分享的页面
	<button type="button" onclick="share()">分享</button>
</body>
</html>